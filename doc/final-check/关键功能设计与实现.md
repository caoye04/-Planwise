# PlanWise 应用架构与关键功能技术实现

## 1. 整体架构

PlanWise 采用了现代化的 **MVVM 架构模式**，实现了前后端分离设计：
- **前端**：Android 原生应用 (Java)
- **后端**：Python Django 框架
- **数据存储**：本地采用 Room 数据库，云端使用 SQLite

项目整合了以下 Android Jetpack 核心组件：
- **Room** - 高效本地存储与 SQL 查询
- **LiveData** - 响应式 UI 更新机制
- **ViewModel** - UI 数据管理与状态保持
- **DataBinding** - 减少手动 UI 更新的样板代码
- **WorkManager** - 调度周期性同步任务

## 2. 用户界面设计

- **Material 3 设计风格**：应用最新的 Android 设计语言
- **自适应布局**：专门适配全面屏设备，解决摄像头区域显示问题
- **底部导航系统**：自定义导航图标与优化显示效果
- **高效 RecyclerView 实现**：优化滚动与数据展示
- **动态标记系统**：自定义 Chip 组件展示任务标签
- **状态化 UI**：通过状态模式处理任务的不同视觉表现

## 3. 数据模型与存储设计

### 数据库实体设计
- **Task 实体**：包含任务标题、描述、到期日期、优先级、修改时间戳等字段
- **Tag 实体**：存储标签名称、颜色信息
- **关联表**：建立 Task 与 Tag 之间的多对多关系

### 数据访问层
- 每个实体都对应专门的 DAO (数据访问对象)
- 提供精细的 CRUD 操作和复杂查询方法
- 使用 Flow 返回类型实现数据变更的自动通知

## 4. 任务与日程管理核心功能

### 基础功能
- 任务与日程的创建、编辑、删除和状态更新
- 任务详情查看与编辑界面
- 完成状态标记与跟踪

### 多维度筛选系统
- **状态筛选**：利用 Room 直接 SQL 查询对已完成/未完成任务进行过滤
- **标签筛选**：采用 JOIN 语句查询关联特定标签的任务
- **时间筛选**：实现日期计算算法，处理"今日"、"近三天"和"本周"等相对时间概念

### 筛选实现方式
- 通过 Repository 层实现，将复杂查询逻辑从 UI 层隔离
- 采用组合模式处理筛选组合逻辑
- 优先应用主筛选条件，然后在内存中过滤次要条件，保证效率和灵活性

## 5. 云同步技术实现

### 双向同步架构
- 使用 **Retrofit** 处理 RESTful API 调用，实现与 Django 后端通信
- 实现基于时间戳的乐观并发控制算法，每个任务都附带修改时间戳
- 在 2023 年 5 月 11 日完成从纯本地应用到云端同步应用的技术转变

### 同步流程与冲突处理
1. 上传本地变更到服务器
2. 下载服务器最新数据
3. 通过时间戳比较算法解决冲突 (更新时间戳较新的版本优先)
4. 实现增量同步减少数据传输量

### 网络处理
- WorkManager 负责调度周期性同步任务
- 实现网络不稳定情况下的重试逻辑
- 保证多设备间数据一致性

## 6. AI 助手功能

### AI 推荐系统
- 基于 **TensorFlow Lite** 实现任务优先级推荐系统
- 特征工程提取用户行为模式：
  - 历史完成时间分析
  - 任务特性分类
  - 上下文信息处理

### 实现细节
- 数据规范化和特征向量构建
- 推理结果转换为具体任务优先级建议
- 提供时间分配建议和个性化提示
- 模块化设计允许单独更新和迭代 AI 模型

### 用户个性化
- 通过分析用户习惯提供定制化建议
- 学习用户偏好以优化任务管理建议

## 7. 系统架构优势

- **高度模块化**：各功能模块相对独立，便于维护和扩展
- **响应式设计**：基于 LiveData 的数据流保证 UI 实时更新
- **离线优先策略**：即使没有网络连接也能正常工作
- **增量式同步**：减少数据传输，提高同步效率
- **可扩展性**：架构设计考虑未来功能扩展需求
