你好！我最近在写一个TODOLISTAPP的项目。它的要求与项目框架如下。具体代码细节如下。它目前是一个前端：andriodstudio+java；后端django的框架。

我目前已经完成了：添加、排序、筛选、云端同步、AI提建议等功能

所有功能都已经基本完善啦！好耶

我现在想做一些界面逻辑的优化

1. 在待办列表界面，需要做到目前筛选内容提示，比如我点击近三天的筛选后，应当在主界面会提醒我目前的筛选情况，如果无筛选就还是保持原来的UI
2. 在日程界面，我感觉这个日历做的用户友好型一般，我希望能做一个小优化，会当前界面日历中检测每一天（日历中一个月的量）是否有未完成的待办，如果有，对日历中的那天的那个数字进行特殊处理，比如高亮？我希望不要太突兀且尽量美观
3. 我希望在我的界面，个人信息那个方框内部的右侧能留一个圆型的框，我用于放用户头像。我已经有了一个图片资源：user.png，你需要帮我完成改UI，加图等一些列操作

我希望你模拟成一个程序员，用步骤的方式带我一步一步细致入微地完成这一个功能。

要求每一步的更改都给出当前文件的完整代码。

同时我不希望你做任何额外的功能，只需要满足我的需求即可





# Planwise 项目架构与细节代码

### 项目功能点需求

添加待办事项，为待办事项添加分类标签、时间、地点。

通过点击快速修改完成/未完成的待办事项状态。

按时间排序待办事项。

按类别筛选未完成的待办事项。

筛选某一时间段的待办事项。

查看全部已完成/未完成的待办事项。

将本地数据与云端同步。

AI智能提建议



### 项目框架

```cmd
planwise_server/
├── api/
│   ├── migrations/
│   ├── __pycache__/
│   ├── admin.py
│   ├── apps.py
│   ├── models.py
│   ├── serializers.py
│   ├── tests.py
│   ├── urls.py
│   ├── views.py
│   └── __init__.py
├── planwise_server/
│   ├── __pycache__/
│   ├── asgi.py
│   ├── settings.py
│   ├── urls.py
│   ├── wsgi.py
│   └── __init__.py
├── db.sqlite3
└── manage.py
```

```cmd
planwise_frontend/
├── java/
│	├── data/
│	│   ├── db/
│	│   │   ├── AppDatabase.java
│	│   │   ├── DateConverter.java
│	│   │   └── ScheduleDao.java
│	│   ├── model/
│	│   │   ├── Schedule.java
│	│   │   └── User.java
│	│   └── repository/
│	│       ├── ScheduleRepository.java
│	│       └── UserRepository.java
│	└── ui/
│		├── activity/
│		│   ├── AddScheduleActivity.java
│		│   ├── MainActivity.java
│		│   └── ScheduleDetailActivity.java
│		├── adapter/
│		│   └── ScheduleAdapter.java
│		├── fragment/
│		│   ├── CalendarFragment.java
│		│   ├── ProfileFragment.java
│		│   └── TodayTodoFragment.java
│		└── viewmodel/
│			├── ScheduleViewModel.java
│			└── UserViewModel.java
├── res/
│   ├── color/
│   ├── drawable/
│   ├── layout/
│   │   ├── activity_add_schedule.xml
│   │   ├── activity_main.xml
│   │   ├── activity_schedule_detail.xml
│   │   ├── dialog_time_filter.xml
│   │   ├── fragment_calendar.xml
│   │   ├── fragment_profile.xml
│   │   ├── fragment_today_todo.xml
│   │   └── item_schedule.xml
│   ├── menu/
│   │   ├── bottom_nav_menu.xml
│   │   └── menu_schedule_detail.xml
│   ├── mipmap
│   ├── navigation/
│   ├── values/
│   └── xml/
└── AndroidManifest.xml
```

### _server细节代码（在基本模板上改动过的）

#### planwise_server/settings.py

```py
"""
Django settings for planwise_server project.

Generated by 'django-admin startproject' using Django 5.2.1.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-$epjie68*&$!g9e!e#)3!o-c_%@#qcq-)538^-spja7h2#=6-='

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ['*']


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',  # 添加REST框架
    'api',  # 添加我们的API应用
]

# REST框架设置
REST_FRAMEWORK = {
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.AllowAny',
    ]
}

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'planwise_server.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'planwise_server.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = 'static/'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

```

#### planwise_server/urls.py

```py
# planwise_server/urls.py

from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', include('api.urls')),
]
```

#### api/models.py

```python
# api/models.py

from django.db import models

class Schedule(models.Model):
    title = models.CharField(max_length=255)
    description = models.TextField(blank=True, null=True)
    scheduled_date = models.DateTimeField()
    location = models.CharField(max_length=255, blank=True, null=True)
    category = models.CharField(max_length=100)
    is_completed = models.BooleanField(default=False)
    priority = models.IntegerField(default=2)
    is_recurring = models.BooleanField(default=False)
    recurring_pattern = models.CharField(max_length=100, blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.title
```

#### api/serializers.py

```py
# api/serializers.py

from rest_framework import serializers
from .models import Schedule

class ScheduleSerializer(serializers.ModelSerializer):
    isCompleted = serializers.BooleanField(source='is_completed')
    scheduledDate = serializers.DateTimeField(source='scheduled_date')
    
    class Meta:
        model = Schedule
        fields = ['id', 'scheduledDate', 'title', 'description', 'location', 
                  'category', 'isCompleted', 'priority', 'is_recurring', 
                  'recurring_pattern', 'created_at', 'updated_at']
```

#### api/urls.py

```py
# api/urls.py

from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import ScheduleViewSet, sync_all_to_cloud, get_all_from_cloud, get_ai_suggestion

router = DefaultRouter()
router.register(r'schedules', ScheduleViewSet)

urlpatterns = [
    path('', include(router.urls)),
    path('sync-to-cloud/', sync_all_to_cloud, name='sync-to-cloud'),
    path('sync-from-cloud/', get_all_from_cloud, name='sync-from-cloud'),
    path('ai-suggestion/', get_ai_suggestion, name='ai-suggestion'),
]
```

#### api/views.py

```py
# api/views.py

from rest_framework import viewsets, status
from rest_framework.decorators import api_view
from rest_framework.response import Response
from .models import Schedule
from .serializers import ScheduleSerializer
import requests
import json
from datetime import datetime

class ScheduleViewSet(viewsets.ModelViewSet):
    queryset = Schedule.objects.all()
    serializer_class = ScheduleSerializer

@api_view(['POST'])
def sync_all_to_cloud(request):
    """接收客户端的所有Schedule数据，替换服务器上的所有数据"""
    if request.method == 'POST':
        # 清除所有现有数据
        Schedule.objects.all().delete()
        
        # 如果是空列表，直接返回成功
        if not request.data:
            return Response({"message": "所有数据已清除"}, status=status.HTTP_200_OK)
        
        # 批量创建新数据
        serializer = ScheduleSerializer(data=request.data, many=True)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

@api_view(['GET'])
def get_all_from_cloud(request):
    """返回服务器上的所有Schedule数据"""
    if request.method == 'GET':
        schedules = Schedule.objects.all()
        serializer = ScheduleSerializer(schedules, many=True)
        return Response(serializer.data)

@api_view(['POST'])
def get_ai_suggestion(request):
    """获取AI对日程的建议"""
    if request.method == 'POST':
        try:
            # 获取请求数据
            schedule_data = request.data
            
            # 构建提示词
            current_time = datetime.now().strftime("%Y-%m-%d %H:%M")
            
            # 获取日程信息
            title = schedule_data.get('title', '')
            description = schedule_data.get('description', '')
            scheduled_date = schedule_data.get('scheduled_date', '')
            location = schedule_data.get('location', '')
            category = schedule_data.get('category', '')
            is_completed = schedule_data.get('is_completed', False)
            
            # 构建提示文本
            prompt = f"""现在是{current_time}，我计划在{location}于{scheduled_date}前完成{title}，"""
            if description:
                prompt += f"其细节是{description}，"
            prompt += f"这个任务属于{category}类别，"
            prompt += "目前" + ("已经完成" if is_completed else "尚未完成") + "。"
            prompt += """
            请给我一些关于这个任务的建议，注意要求：
            1. 必须使用纯文本格式，不要使用任何Markdown语法（如*加粗*、_斜体_、#标题等）
            2. 使用平实的聊天语气
            3. 直接给出建议，不要添加"以下是我的建议"之类的开场白
            4. 不要在回复结尾添加"需要更多帮助吗"、"还有其他问题吗"之类的结束语
            5. 可以内容丰富一点，但要整体有条例，是一个很好的建议视角
            """
            
            # 调用 DeepSeek API
            deepseek_api_key = "sk-76355a715ce345bc93e5b33431eb92fd"
            headers = {
                "Content-Type": "application/json",
                "Authorization": f"Bearer {deepseek_api_key}"
            }
            
            data = {
                "model": "deepseek-chat",
                "messages": [
                    {"role": "user", "content": prompt}
                ],
                "temperature": 0.7,
                "max_tokens": 300
            }
            
            response = requests.post(
                "https://api.deepseek.com/v1/chat/completions",
                headers=headers,
                data=json.dumps(data)
            )
            
            # 检查响应
            if response.status_code == 200:
                result = response.json()
                ai_suggestion = result['choices'][0]['message']['content']
                
                # 额外处理，移除可能的Markdown语法
                ai_suggestion = ai_suggestion.replace('*', '')
                ai_suggestion = ai_suggestion.replace('_', '')
                ai_suggestion = ai_suggestion.replace('#', '')
                ai_suggestion = ai_suggestion.replace('```', '')
                
                print(ai_suggestion)
                return Response({"suggestion": ai_suggestion}, status=status.HTTP_200_OK)
                
            else:
                return Response(
                    {"error": f"DeepSeek API error: {response.text}"},
                    status=status.HTTP_500_INTERNAL_SERVER_ERROR
                )
                
        except Exception as e:
            return Response(
                {"error": f"Error generating AI suggestion: {str(e)}"},
                status=status.HTTP_500_INTERNAL_SERVER_ERROR
            )
```



### JAVA

#### data/api/ApiClient

```java
// com/example/planwise/data/api/ApiClient.java
package com.example.planwise.data.api;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;

import java.util.concurrent.TimeUnit;

import okhttp3.OkHttpClient;
import retrofit2.Retrofit;
import retrofit2.converter.gson.GsonConverterFactory;

public class ApiClient {
    private static final String BASE_URL = "http://192.168.1.2:8000/"; // 替换为你电脑的局域网IP
    private static Retrofit retrofit = null;
    private static ApiService apiService = null;

    public static ApiService getApiService() {
        if (apiService == null) {
            // 创建 OkHttpClient 并设置超时时间
            OkHttpClient okHttpClient = new OkHttpClient.Builder()
                    .connectTimeout(60, TimeUnit.SECONDS)  // 连接超时时间
                    .readTimeout(60, TimeUnit.SECONDS)     // 读取超时时间
                    .writeTimeout(60, TimeUnit.SECONDS)    // 写入超时时间
                    .build();

            Gson gson = new GsonBuilder()
                    .setDateFormat("yyyy-MM-dd'T'HH:mm:ss")
                    .create();

            retrofit = new Retrofit.Builder()
                    .baseUrl(BASE_URL)
                    .client(okHttpClient)  // 设置客户端
                    .addConverterFactory(GsonConverterFactory.create(gson))
                    .build();

            apiService = retrofit.create(ApiService.class);
        }
        return apiService;
    }

    public static void setBaseUrl(String baseUrl) {
        if (!baseUrl.endsWith("/")) {
            baseUrl = baseUrl + "/";
        }

        // 创建 OkHttpClient 并设置超时时间
        OkHttpClient okHttpClient = new OkHttpClient.Builder()
                .connectTimeout(60, TimeUnit.SECONDS)  // 连接超时时间
                .readTimeout(60, TimeUnit.SECONDS)     // 读取超时时间
                .writeTimeout(60, TimeUnit.SECONDS)    // 写入超时时间
                .build();

        Gson gson = new GsonBuilder()
                .setDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ")
                .create();

        retrofit = new Retrofit.Builder()
                .baseUrl(baseUrl)
                .client(okHttpClient)  // 设置客户端
                .addConverterFactory(GsonConverterFactory.create(gson))
                .build();

        apiService = retrofit.create(ApiService.class);
    }
}
```

#### data/api/ApiService

```java
// com/example/planwise/data/api/ApiService.java
package com.example.planwise.data.api;

import com.example.planwise.data.model.Schedule;

import java.util.List;
import java.util.Map;

import retrofit2.Call;
import retrofit2.http.Headers;
import retrofit2.http.Body;
import retrofit2.http.GET;
import retrofit2.http.POST;

public interface ApiService {
    // 在ApiService中确保正确指定Content-Type
    @Headers("Content-Type: application/json")
    @POST("api/sync-to-cloud/")
    Call<List<Schedule>> uploadAllSchedules(@Body List<Schedule> schedules);

    @GET("api/sync-from-cloud/")
    Call<List<Schedule>> getAllSchedules();
    
    // 添加新的AI建议API方法
    @Headers("Content-Type: application/json")
    @POST("api/ai-suggestion/")
    Call<Map<String, String>> getAiSuggestion(@Body Map<String, Object> scheduleInfo);
}
```

#### data/db/AppDatabase

```java
package com.example.planwise.data.db;


import android.content.Context;

import androidx.room.Database;
import androidx.room.Room;
import androidx.room.RoomDatabase;
import androidx.room.TypeConverters;

import com.example.planwise.data.db.DateConverter;
import com.example.planwise.data.db.ScheduleDao;
import com.example.planwise.data.model.Schedule;

@Database(entities = {Schedule.class}, version = 1, exportSchema = false)
@TypeConverters({DateConverter.class})
public abstract class AppDatabase extends RoomDatabase {

    private static final String DATABASE_NAME = "planwise_db";
    private static AppDatabase instance;

    public abstract ScheduleDao scheduleDao();

    public static synchronized AppDatabase getInstance(Context context) {
        if (instance == null) {
            instance = Room.databaseBuilder(
                            context.getApplicationContext(),
                            AppDatabase.class,
                            DATABASE_NAME)
                    .fallbackToDestructiveMigration()
                    .build();
        }
        return instance;
    }
}
```

#### data/db/DataConverter

```java
package com.example.planwise.data.db;

import androidx.room.TypeConverter;

import java.util.Date;

public class DateConverter {
    @TypeConverter
    public static Date toDate(Long timestamp) {
        return timestamp == null ? null : new Date(timestamp);
    }

    @TypeConverter
    public static Long toTimestamp(Date date) {
        return date == null ? null : date.getTime();
    }
}

```

#### data/db/ScheduleDao

```java
package com.example.planwise.data.db;

import androidx.lifecycle.LiveData;
import androidx.room.Dao;
import androidx.room.Delete;
import androidx.room.Insert;
import androidx.room.OnConflictStrategy;
import androidx.room.Query;
import androidx.room.Update;

import com.example.planwise.data.model.Schedule;

import java.util.Date;
import java.util.List;

@Dao
public interface ScheduleDao {

    @Insert(onConflict = OnConflictStrategy.REPLACE)
    long insertSchedule(Schedule schedule);

    @Update
    void updateSchedule(Schedule schedule);

    @Delete
    void deleteSchedule(Schedule schedule);

    @Query("SELECT * FROM schedules WHERE id = :id")
    LiveData<Schedule> getScheduleById(long id);

    @Query("SELECT * FROM schedules ORDER BY scheduledDate ASC")
    LiveData<List<Schedule>> getAllSchedules();

    @Query("SELECT * FROM schedules ORDER BY scheduledDate ASC")
    List<Schedule> getAllSchedulesSync();

    @Query("DELETE FROM schedules")
    void deleteAllSchedules();

    @Query("SELECT * FROM schedules WHERE isCompleted = 0 ORDER BY scheduledDate ASC")
    LiveData<List<Schedule>> getIncompleteSchedules();

    @Query("SELECT * FROM schedules WHERE isCompleted = 1 ORDER BY scheduledDate DESC")
    LiveData<List<Schedule>> getCompletedSchedules();

    @Query("SELECT * FROM schedules WHERE date(scheduledDate/1000, 'unixepoch') = date(:date/1000, 'unixepoch') ORDER BY scheduledDate ASC")
    LiveData<List<Schedule>> getSchedulesByDate(Date date);

    @Query("SELECT * FROM schedules WHERE category = :category AND isCompleted = 0 ORDER BY scheduledDate ASC")
    LiveData<List<Schedule>> getIncompleteSchedulesByCategory(String category);

    @Query("SELECT * FROM schedules WHERE scheduledDate BETWEEN :startDate AND :endDate ORDER BY scheduledDate ASC")
    LiveData<List<Schedule>> getSchedulesBetweenDates(Date startDate, Date endDate);

    @Query("SELECT DISTINCT category FROM schedules")
    LiveData<List<String>> getAllCategories();

    @Query("SELECT * FROM schedules WHERE lastSynced IS NULL OR lastSynced < :lastSync")
    List<Schedule> getUnSyncedSchedules(Date lastSync);
}
```

#### data/model/Schedule

```java
package com.example.planwise.data.model;

import androidx.room.Entity;
import androidx.room.PrimaryKey;
import androidx.room.TypeConverters;

import com.example.planwise.data.db.DateConverter;

import java.util.Date;

@Entity(tableName = "schedules")
public class Schedule {
    @PrimaryKey(autoGenerate = true)
    private long id;

    private String title;
    private String description;

    @TypeConverters(DateConverter.class)
    private Date scheduledDate;

    private String location;
    private String category;
    private boolean isCompleted;
    private int priority; // 1-3 representing low, medium, high
    private boolean isRecurring;
    private String recurringPattern; // daily, weekly, monthly

    // Last sync timestamp for cloud sync
    @TypeConverters(DateConverter.class)
    private Date lastSynced;

    // Constructor, getters and setters
    public Schedule(String title, String description, Date scheduledDate,
                    String location, String category, boolean isCompleted) {
        this.title = title;
        this.description = description;
        this.scheduledDate = scheduledDate;
        this.location = location;
        this.category = category;
        this.isCompleted = isCompleted;
        this.priority = 2; // Default medium priority
        this.isRecurring = false;
    }

    // Getters and setters
    public long getId() {
        return id;
    }

    public void setId(long id) {
        this.id = id;
    }

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public Date getScheduledDate() {
        return scheduledDate;
    }

    public void setScheduledDate(Date scheduledDate) {
        this.scheduledDate = scheduledDate;
    }

    public String getLocation() {
        return location;
    }

    public void setLocation(String location) {
        this.location = location;
    }

    public String getCategory() {
        return category;
    }

    public void setCategory(String category) {
        this.category = category;
    }

    public boolean isCompleted() {
        return isCompleted;
    }

    public void setCompleted(boolean completed) {
        isCompleted = completed;
    }

    public int getPriority() {
        return priority;
    }

    public void setPriority(int priority) {
        this.priority = priority;
    }

    public boolean isRecurring() {
        return isRecurring;
    }

    public void setRecurring(boolean recurring) {
        isRecurring = recurring;
    }

    public String getRecurringPattern() {
        return recurringPattern;
    }

    public void setRecurringPattern(String recurringPattern) {
        this.recurringPattern = recurringPattern;
    }

    public Date getLastSynced() {
        return lastSynced;
    }

    public void setLastSynced(Date lastSynced) {
        this.lastSynced = lastSynced;
    }
}
```

#### data/model/User

```java
package com.example.planwise.data.model;

public class User {
    private String userId;
    private String username;
    private String email;
    private String photoUrl;
    private boolean syncEnabled;

    public User() {
        // Default constructor required for Firebase
    }

    public User(String userId, String username, String email) {
        this.userId = userId;
        this.username = username;
        this.email = email;
        this.syncEnabled = false;
    }

    // Getters and setters
    public String getUserId() {
        return userId;
    }

    public void setUserId(String userId) {
        this.userId = userId;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getPhotoUrl() {
        return photoUrl;
    }

    public void setPhotoUrl(String photoUrl) {
        this.photoUrl = photoUrl;
    }

    public boolean isSyncEnabled() {
        return syncEnabled;
    }

    public void setSyncEnabled(boolean syncEnabled) {
        this.syncEnabled = syncEnabled;
    }
}
```

#### data/repository/ScheduleRepository

```java
package com.example.planwise.data.repository;

import android.app.Application;
import android.os.AsyncTask;
import android.util.Log;

import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;

import com.example.planwise.data.api.ApiClient;
import com.example.planwise.data.api.ApiService;
import com.example.planwise.data.db.AppDatabase;
import com.example.planwise.data.db.ScheduleDao;
import com.example.planwise.data.model.Schedule;

import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import retrofit2.Call;
import retrofit2.Response;

public class ScheduleRepository {
    private static final String TAG = "ScheduleRepository";
    private ScheduleDao scheduleDao;
    private ApiService apiService;
    private ExecutorService executorService;
    private LiveData<List<Schedule>> allSchedules;
    private LiveData<List<Schedule>> incompleteSchedules;
    private LiveData<List<Schedule>> completedSchedules;
    private LiveData<List<String>> allCategories;
    private MutableLiveData<Boolean> isSyncing = new MutableLiveData<>(false);

    public ScheduleRepository(Application application) {
        AppDatabase database = AppDatabase.getInstance(application);
        scheduleDao = database.scheduleDao();
        apiService = ApiClient.getApiService();
        executorService = Executors.newFixedThreadPool(4);

        allSchedules = scheduleDao.getAllSchedules();
        incompleteSchedules = scheduleDao.getIncompleteSchedules();
        completedSchedules = scheduleDao.getCompletedSchedules();
        allCategories = scheduleDao.getAllCategories();
    }

    // Schedule operations
    public void insert(Schedule schedule) {
        executorService.execute(() -> {
            long id = scheduleDao.insertSchedule(schedule);
            schedule.setId(id);
        });
    }

    public void update(Schedule schedule) {
        executorService.execute(() -> scheduleDao.updateSchedule(schedule));
    }

    public void delete(Schedule schedule) {
        executorService.execute(() -> scheduleDao.deleteSchedule(schedule));
    }

    public void toggleCompleted(Schedule schedule) {
        schedule.setCompleted(!schedule.isCompleted());
        update(schedule);
    }

    // Getters for LiveData
    public LiveData<List<Schedule>> getAllSchedules() {
        return allSchedules;
    }

    public LiveData<List<Schedule>> getIncompleteSchedules() {
        return incompleteSchedules;
    }

    public LiveData<List<Schedule>> getCompletedSchedules() {
        return completedSchedules;
    }

    public LiveData<Schedule> getScheduleById(long id) {
        return scheduleDao.getScheduleById(id);
    }

    public LiveData<List<Schedule>> getSchedulesByDate(Date date) {
        return scheduleDao.getSchedulesByDate(date);
    }

    public LiveData<List<Schedule>> getIncompleteSchedulesByCategory(String category) {
        return scheduleDao.getIncompleteSchedulesByCategory(category);
    }

    public LiveData<List<Schedule>> getSchedulesBetweenDates(Date startDate, Date endDate) {
        return scheduleDao.getSchedulesBetweenDates(startDate, endDate);
    }

    public LiveData<List<String>> getAllCategories() {
        return allCategories;
    }

    public LiveData<Boolean> getIsSyncing() {
        return isSyncing;
    }

    // 同步本地数据到云端
    public void syncLocalToCloud(OnSyncCompleteListener listener) {
        isSyncing.postValue(true);

        executorService.execute(() -> {
            try {
                // 获取本地所有日程
                List<Schedule> localSchedules = getAllSchedulesSync();

                // 上传到云端
                Call<List<Schedule>> call = apiService.uploadAllSchedules(localSchedules);
                Response<List<Schedule>> response = call.execute();

                if (response.isSuccessful()) {
                    // 同步成功
                    if (listener != null) {
                        listener.onSyncComplete(true, "本地数据已成功同步到云端");
                    }
                } else {
                    // 同步失败
                    if (listener != null) {
                        listener.onSyncComplete(false, "同步失败: " + response.message());
                    }
                }
            } catch (IOException e) {
                Log.e(TAG, "同步到云端失败", e);
                if (listener != null) {
                    listener.onSyncComplete(false, "同步失败: " + e.getMessage());
                }
            } finally {
                isSyncing.postValue(false);
            }
        });
    }

    // 同步云端数据到本地
    public void syncCloudToLocal(OnSyncCompleteListener listener) {
        isSyncing.postValue(true);

        executorService.execute(() -> {
            try {
                // 从云端获取数据
                Call<List<Schedule>> call = apiService.getAllSchedules();
                Response<List<Schedule>> response = call.execute();

                if (response.isSuccessful() && response.body() != null) {
                    // 清除本地数据并保存云端数据
                    deleteAllSchedulesSync();
                    List<Schedule> cloudSchedules = response.body();

                    // 将云端数据插入到本地数据库
                    for (Schedule schedule : cloudSchedules) {
                        // 确保ID不冲突（可能需要根据你的ID生成策略调整）
                        schedule.setId(0); // Room会自动生成新的ID
                        scheduleDao.insertSchedule(schedule);
                    }

                    if (listener != null) {
                        listener.onSyncComplete(true, "云端数据已成功同步到本地");
                    }
                } else {
                    if (listener != null) {
                        listener.onSyncComplete(false, "从云端获取数据失败: " + response.message());
                    }
                }
            } catch (IOException e) {
                Log.e(TAG, "从云端同步失败", e);
                if (listener != null) {
                    listener.onSyncComplete(false, "同步失败: " + e.getMessage());
                }
            } finally {
                isSyncing.postValue(false);
            }
        });
    }
    
    // 获取AI建议
    public void getAiSuggestion(Schedule schedule, OnAiSuggestionListener listener) {
        executorService.execute(() -> {
            try {
                // 构建请求参数
                Map<String, Object> params = new HashMap<>();
                params.put("title", schedule.getTitle());
                params.put("description", schedule.getDescription());
                
                // 格式化日期时间
                SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm", Locale.getDefault());
                params.put("scheduled_date", dateFormat.format(schedule.getScheduledDate()));
                
                params.put("location", schedule.getLocation());
                params.put("category", schedule.getCategory());
                params.put("is_completed", schedule.isCompleted());
                
                // 发送请求
                Call<Map<String, String>> call = apiService.getAiSuggestion(params);
                Response<Map<String, String>> response = call.execute();
                
                if (response.isSuccessful() && response.body() != null) {
                    String suggestion = response.body().get("suggestion");
                    if (listener != null) {
                        listener.onAiSuggestionReceived(true, suggestion);
                    }
                } else {
                    if (listener != null) {
                        listener.onAiSuggestionReceived(false, "获取AI建议失败: " + response.message());
                    }
                }
            } catch (IOException e) {
                Log.e(TAG, "获取AI建议失败", e);
                if (listener != null) {
                    listener.onAiSuggestionReceived(false, "获取AI建议失败: " + e.getMessage());
                }
            }
        });
    }

    // 获取所有日程（同步方法）
    private List<Schedule> getAllSchedulesSync() {
        // 这个方法需要内部使用，直接同步获取所有日程
        AppDatabase db = AppDatabase.getInstance(null);
        return db.scheduleDao().getAllSchedulesSync();
    }

    // 删除所有日程（同步方法）
    private void deleteAllSchedulesSync() {
        AppDatabase db = AppDatabase.getInstance(null);
        db.scheduleDao().deleteAllSchedules();
    }

    // 同步完成监听器接口
    public interface OnSyncCompleteListener {
        void onSyncComplete(boolean success, String message);
    }
    
    // AI建议完成监听器接口
    public interface OnAiSuggestionListener {
        void onAiSuggestionReceived(boolean success, String suggestion);
    }
}
```

#### data/repository/UserRepository

```java
package com.example.planwise.data.repository;

import android.app.Application;
import android.content.SharedPreferences;
import android.preference.PreferenceManager;

import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;

import com.example.planwise.data.model.User;

public class UserRepository {
    private SharedPreferences prefs;
    private MutableLiveData<User> currentUser = new MutableLiveData<>();
    private MutableLiveData<Boolean> isLoggedIn = new MutableLiveData<>();

    public UserRepository(Application application) {
        prefs = PreferenceManager.getDefaultSharedPreferences(application);
        isLoggedIn.setValue(isUserLoggedIn());
        if (isUserLoggedIn()) {
            loadUserFromPrefs();
        }
    }

    private boolean isUserLoggedIn() {
        return prefs.contains("user_id");
    }

    private void loadUserFromPrefs() {
        String userId = prefs.getString("user_id", null);
        String username = prefs.getString("username", null);
        String email = prefs.getString("email", null);
        String photoUrl = prefs.getString("photo_url", null);
        boolean syncEnabled = prefs.getBoolean("sync_enabled", false);

        if (userId != null && username != null) {
            User user = new User(userId, username, email);
            user.setPhotoUrl(photoUrl);
            user.setSyncEnabled(syncEnabled);
            currentUser.setValue(user);
        }
    }

    public void login(String userId, String username, String email) {
        User user = new User(userId, username, email);

        // Save to preferences
        prefs.edit()
                .putString("user_id", userId)
                .putString("username", username)
                .putString("email", email)
                .apply();

        currentUser.setValue(user);
        isLoggedIn.setValue(true);
    }

    public void logout() {
        prefs.edit()
                .remove("user_id")
                .remove("username")
                .remove("email")
                .remove("photo_url")
                .apply();

        currentUser.setValue(null);
        isLoggedIn.setValue(false);
    }

    public void updateSyncPreference(boolean enabled) {
        User user = currentUser.getValue();
        if (user != null) {
            user.setSyncEnabled(enabled);
            currentUser.setValue(user);

            prefs.edit()
                    .putBoolean("sync_enabled", enabled)
                    .apply();
        }
    }

    public LiveData<User> getCurrentUser() {
        return currentUser;
    }

    public LiveData<Boolean> getIsLoggedIn() {
        return isLoggedIn;
    }
}
```

#### ui/acticity/AddScheduleActivity

```java
package com.example.planwise.ui.activity;

import android.os.Bundle;
import android.view.MenuItem;
import android.widget.Button;
import android.widget.EditText;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.ViewModelProvider;

import com.google.android.material.chip.Chip;
import com.google.android.material.chip.ChipGroup;
import com.google.android.material.datepicker.MaterialDatePicker;
import com.google.android.material.timepicker.MaterialTimePicker;
import com.google.android.material.timepicker.TimeFormat;
import com.example.planwise.R;
import com.example.planwise.data.model.Schedule;
import com.example.planwise.ui.viewmodel.ScheduleViewModel;

import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.Locale;

public class AddScheduleActivity extends AppCompatActivity {

    private ScheduleViewModel viewModel;
    private EditText editTextTitle;
    private EditText editTextDescription;
    private EditText editTextDate;
    private EditText editTextTime;
    private EditText editTextLocation;
    private ChipGroup chipGroupCategory;
    private Button buttonSave;
    private Button buttonAddTag;

    private Calendar selectedDateTime = Calendar.getInstance();
    private SimpleDateFormat dateFormat = new SimpleDateFormat("MMM dd, yyyy", Locale.getDefault());
    private SimpleDateFormat timeFormat = new SimpleDateFormat("HH:mm", Locale.getDefault());

    // 预设标签数组
    private String[] defaultCategories = {"个人", "学习", "工作", "健康", "购物", "社交", "家庭", "休闲"};

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_add_schedule);

        // 安全地设置 ActionBar
        if (getSupportActionBar() != null) {
            getSupportActionBar().setDisplayHomeAsUpEnabled(true);
            getSupportActionBar().setTitle("新建待办");
        }

        // Setup ViewModel
        viewModel = new ViewModelProvider(this).get(ScheduleViewModel.class);

        // Initialize views
        editTextTitle = findViewById(R.id.edit_text_title);
        editTextDescription = findViewById(R.id.edit_text_description);
        editTextDate = findViewById(R.id.edit_text_date);
        editTextTime = findViewById(R.id.edit_text_time);
        editTextLocation = findViewById(R.id.edit_text_location);
        chipGroupCategory = findViewById(R.id.chip_group_category);
        buttonSave = findViewById(R.id.button_save);
        buttonAddTag = findViewById(R.id.button_add_tag);

        // Initialize date and time
        updateDateText();
        updateTimeText();

        // Setup date picker dialog
        editTextDate.setOnClickListener(v -> {
            MaterialDatePicker<Long> datePicker = MaterialDatePicker.Builder.datePicker()
                    .setTitleText("Select date")
                    .setSelection(selectedDateTime.getTimeInMillis())
                    .build();

            datePicker.addOnPositiveButtonClickListener(selection -> {
                selectedDateTime.setTimeInMillis(selection);
                updateDateText();
            });

            datePicker.show(getSupportFragmentManager(), "DATE_PICKER");
        });

        // Setup time picker dialog
        editTextTime.setOnClickListener(v -> {
            MaterialTimePicker timePicker = new MaterialTimePicker.Builder()
                    .setTimeFormat(TimeFormat.CLOCK_24H)
                    .setHour(selectedDateTime.get(Calendar.HOUR_OF_DAY))
                    .setMinute(selectedDateTime.get(Calendar.MINUTE))
                    .setTitleText("Select time")
                    .build();

            timePicker.addOnPositiveButtonClickListener(v1 -> {
                selectedDateTime.set(Calendar.HOUR_OF_DAY, timePicker.getHour());
                selectedDateTime.set(Calendar.MINUTE, timePicker.getMinute());
                updateTimeText();
            });

            timePicker.show(getSupportFragmentManager(), "TIME_PICKER");
        });

        // 添加新标签按钮点击事件
        buttonAddTag.setOnClickListener(v -> {
            showAddTagDialog();
        });

        // Populate categories
        loadCategories();

        // Save button click listener
        buttonSave.setOnClickListener(v -> saveSchedule());
    }

    private void loadCategories() {
        chipGroupCategory.removeAllViews();
        
        // 先加载预设标签
        for (String category : defaultCategories) {
            addCategoryChip(category);
        }

        // 然后观察数据库中的标签
        viewModel.getAllCategories().observe(this, categories -> {
            // 添加数据库中有的但预设标签中没有的标签
            if (categories != null) {
                for (String category : categories) {
                    boolean exists = false;
                    for (String defaultCategory : defaultCategories) {
                        if (defaultCategory.equals(category)) {
                            exists = true;
                            break;
                        }
                    }
                    if (!exists) {
                        addCategoryChip(category);
                    }
                }
            }
        });
    }

    private void addCategoryChip(String category) {
        // 检查是否已经存在
        for (int i = 0; i < chipGroupCategory.getChildCount(); i++) {
            Chip existingChip = (Chip) chipGroupCategory.getChildAt(i);
            if (existingChip.getText().toString().equals(category)) {
                return; // 如果已存在，就不添加了
            }
        }

        Chip chip = new Chip(this);
        chip.setText(category);
        chip.setCheckable(true);
        chipGroupCategory.addView(chip);
    }

    private void updateDateText() {
        editTextDate.setText(dateFormat.format(selectedDateTime.getTime()));
    }

    private void updateTimeText() {
        editTextTime.setText(timeFormat.format(selectedDateTime.getTime()));
    }

    private void saveSchedule() {
        String title = editTextTitle.getText().toString().trim();
        String description = editTextDescription.getText().toString().trim();
        String location = editTextLocation.getText().toString().trim();

        if (title.isEmpty()) {
            editTextTitle.setError("Title cannot be empty");
            return;
        }

        // Get selected category
        String category = "其他";
        int checkedChipId = chipGroupCategory.getCheckedChipId();
        if (checkedChipId != -1) {
            Chip selectedChip = findViewById(checkedChipId);
            category = selectedChip.getText().toString();
        }

        // Create and save schedule
        Schedule schedule = new Schedule(
                title,
                description,
                selectedDateTime.getTime(),
                location,
                category,
                false
        );

        viewModel.insertSchedule(schedule);
        finish();
    }

    // 显示添加新标签的对话框
    private void showAddTagDialog() {
        androidx.appcompat.app.AlertDialog.Builder builder = new androidx.appcompat.app.AlertDialog.Builder(this);
        builder.setTitle("添加新标签");

        // 设置输入框
        final EditText input = new EditText(this);
        input.setHint("请输入标签名称");
        builder.setView(input);

        // 设置按钮
        builder.setPositiveButton("添加", (dialog, which) -> {
            String newTag = input.getText().toString().trim();
            if (!newTag.isEmpty()) {
                // 添加新标签
                addCategoryChip(newTag);
                // 自动选中新标签
                for (int i = 0; i < chipGroupCategory.getChildCount(); i++) {
                    Chip chip = (Chip) chipGroupCategory.getChildAt(i);
                    if (chip.getText().toString().equals(newTag)) {
                        chip.setChecked(true);
                        break;
                    }
                }
            }
        });
        builder.setNegativeButton("取消", (dialog, which) -> dialog.cancel());

        builder.show();
    }

    @Override
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {
        if (item.getItemId() == android.R.id.home) {
            onBackPressed();
            return true;
        }
        return super.onOptionsItemSelected(item);
    }
}
```

#### ui/activity/MainActivity

```java
package com.example.planwise.ui.activity;

import android.os.Bundle;

import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.ViewModelProvider;
import androidx.navigation.NavController;
import androidx.navigation.fragment.NavHostFragment;
import androidx.navigation.ui.NavigationUI;

import com.google.android.material.bottomnavigation.BottomNavigationView;
import com.example.planwise.R;
import com.example.planwise.ui.viewmodel.ScheduleViewModel;
import com.example.planwise.ui.viewmodel.UserViewModel;

public class MainActivity extends AppCompatActivity {

//    private ScheduleViewModel scheduleViewModel;
//    private UserViewModel userViewModel;
    private NavController navController;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

//         Setup ViewModels
//        scheduleViewModel = new ViewModelProvider(this).get(ScheduleViewModel.class);
//        userViewModel = new ViewModelProvider(this).get(UserViewModel.class);

        // Setup navigation
        BottomNavigationView bottomNavigationView = findViewById(R.id.bottom_navigation);
        NavHostFragment navHostFragment = (NavHostFragment) getSupportFragmentManager()
                .findFragmentById(R.id.nav_host_fragment);
        navController = navHostFragment.getNavController();

        // Connect BottomNavigationView with NavController
        NavigationUI.setupWithNavController(bottomNavigationView, navController);

        // Observe login state
//        userViewModel.getIsLoggedIn().observe(this, isLoggedIn -> {
//            // Optional: Handle login/logout state changes
//        });
    }
}
```

#### ui/activity/ScheduleDetailActivity

```java
package com.example.planwise.ui.activity;

import android.os.Bundle;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.ProgressBar;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AlertDialog;
import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.ViewModelProvider;

import com.example.planwise.R;
import com.example.planwise.data.model.Schedule;
import com.example.planwise.ui.viewmodel.ScheduleViewModel;

import java.text.SimpleDateFormat;
import java.util.Locale;

public class ScheduleDetailActivity extends AppCompatActivity {

    private ScheduleViewModel viewModel;
    private Schedule currentSchedule;

    private TextView textViewTitle;
    private TextView textViewDescription;
    private TextView textViewDateTime;
    private TextView textViewLocation;
    private TextView textViewCategory;
    private CheckBox checkBoxCompleted;
    private TextView textViewAiSuggestion;
    private Button buttonGetAiSuggestion;
    private ProgressBar progressAiSuggestion;

    private SimpleDateFormat dateTimeFormat = new SimpleDateFormat("EEEE, MMM dd, yyyy HH:mm", Locale.getDefault());

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_schedule_detail);

        // Enable back button in action bar
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);
        getSupportActionBar().setTitle("日程详情");

        // Initialize views
        textViewTitle = findViewById(R.id.text_view_title);
        textViewDescription = findViewById(R.id.text_view_description);
        textViewDateTime = findViewById(R.id.text_view_date_time);
        textViewLocation = findViewById(R.id.text_view_location);
        textViewCategory = findViewById(R.id.text_view_category);
        checkBoxCompleted = findViewById(R.id.checkbox_completed);
        textViewAiSuggestion = findViewById(R.id.text_view_ai_suggestion);
        buttonGetAiSuggestion = findViewById(R.id.button_get_ai_suggestion);
        progressAiSuggestion = findViewById(R.id.progress_ai_suggestion);

        // Setup ViewModel
        viewModel = new ViewModelProvider(this).get(ScheduleViewModel.class);

        // Get schedule ID from intent
        long scheduleId = getIntent().getLongExtra("schedule_id", -1);
        if (scheduleId == -1) {
            Toast.makeText(this, "错误：未找到日程", Toast.LENGTH_SHORT).show();
            finish();
            return;
        }

        // Observe schedule details
        viewModel.getScheduleById(scheduleId).observe(this, schedule -> {
            if (schedule != null) {
                currentSchedule = schedule;
                displayScheduleDetails(schedule);
            } else {
                Toast.makeText(this, "未找到日程", Toast.LENGTH_SHORT).show();
                finish();
            }
        });

        // Setup checkbox listener
        checkBoxCompleted.setOnClickListener(v -> {
            if (currentSchedule != null) {
                viewModel.toggleScheduleCompleted(currentSchedule);
            }
        });
        
        // Setup AI suggestion button
        buttonGetAiSuggestion.setOnClickListener(v -> {
            if (currentSchedule != null) {
                // 显示加载提示
                textViewAiSuggestion.setText("正在获取 AI 小助手的建议，请稍等...");
                // 调用 AI 建议方法
                viewModel.getAiSuggestion(currentSchedule);
            }
        });
        
        // Observe AI suggestion loading state
        viewModel.getIsLoadingAiSuggestion().observe(this, isLoading -> {
            progressAiSuggestion.setVisibility(isLoading ? View.VISIBLE : View.GONE);
            buttonGetAiSuggestion.setEnabled(!isLoading);
            if (isLoading) {
                buttonGetAiSuggestion.setText("正在获取建议...");
            } else {
                buttonGetAiSuggestion.setText("问问PlanWiseAI的建议吧！");
            }
        });
        
        // Observe AI suggestion
        viewModel.getAiSuggestion().observe(this, suggestion -> {
            if (suggestion != null && !suggestion.isEmpty()) {
                textViewAiSuggestion.setText(suggestion);
            }
        });
    }

    private void displayScheduleDetails(Schedule schedule) {
        textViewTitle.setText(schedule.getTitle());

        // Description (show "No description" if empty)
        if (schedule.getDescription() != null && !schedule.getDescription().isEmpty()) {
            textViewDescription.setText(schedule.getDescription());
        } else {
            textViewDescription.setText("暂无描述");
        }

        // Date and time
        if (schedule.getScheduledDate() != null) {
            textViewDateTime.setText(dateTimeFormat.format(schedule.getScheduledDate()));
        } else {
            textViewDateTime.setText("未指定日期");
        }

        // Location (show "No location" if empty)
        if (schedule.getLocation() != null && !schedule.getLocation().isEmpty()) {
            textViewLocation.setText(schedule.getLocation());
        } else {
            textViewLocation.setText("未指定地点");
        }

        textViewCategory.setText(schedule.getCategory());
        checkBoxCompleted.setChecked(schedule.isCompleted());
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        getMenuInflater().inflate(R.menu.menu_schedule_detail, menu);
        return true;
    }

    @Override
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {
        int id = item.getItemId();

        if (id == android.R.id.home) {
            onBackPressed();
            return true;
        } else if (id == R.id.action_edit) {
            // Intent to edit schedule (not implemented in this code sample)
            Toast.makeText(this, "编辑功能", Toast.LENGTH_SHORT).show();
            return true;
        } else if (id == R.id.action_delete) {
            confirmDeleteSchedule();
            return true;
        }

        return super.onOptionsItemSelected(item);
    }

    private void confirmDeleteSchedule() {
        new AlertDialog.Builder(this)
                .setTitle("删除日程")
                .setMessage("确定要删除这个日程吗？")
                .setPositiveButton("删除", (dialog, which) -> {
                    if (currentSchedule != null) {
                        viewModel.deleteSchedule(currentSchedule);
                        finish();
                    }
                })
                .setNegativeButton("取消", null)
                .show();
    }
}
```

#### ui/adapter/ScheduleAdapter

```java
package com.example.planwise.ui.adapter;

import android.graphics.Paint;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.CheckBox;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.DiffUtil;
import androidx.recyclerview.widget.ListAdapter;
import androidx.recyclerview.widget.RecyclerView;

import com.example.planwise.R;
import com.example.planwise.data.model.Schedule;

import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.Locale;
import java.util.concurrent.TimeUnit;

public class ScheduleAdapter extends ListAdapter<Schedule, ScheduleAdapter.ScheduleViewHolder> {

    private OnScheduleListener listener;
    private SimpleDateFormat timeFormat = new SimpleDateFormat("HH:mm", Locale.getDefault());

    public ScheduleAdapter(OnScheduleListener listener) {
        super(DIFF_CALLBACK);
        this.listener = listener;
    }

    @NonNull
    @Override
    public ScheduleViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View itemView = LayoutInflater.from(parent.getContext())
                .inflate(R.layout.item_schedule, parent, false);
        return new ScheduleViewHolder(itemView);
    }

    @Override
    public void onBindViewHolder(@NonNull ScheduleViewHolder holder, int position) {
        Schedule currentSchedule = getItem(position);
        holder.textViewTitle.setText(currentSchedule.getTitle());

        if (currentSchedule.getScheduledDate() != null) {
            // 设置格式化后的时间描述
            holder.textViewTime.setText(getFormattedTimeDescription(currentSchedule.getScheduledDate()));
        } else {
            holder.textViewTime.setText("全天");
        }

        holder.textViewCategory.setText(currentSchedule.getCategory());
        holder.checkBoxCompleted.setChecked(currentSchedule.isCompleted());

        // 应用删除线样式如果已完成
        if (currentSchedule.isCompleted()) {
            holder.textViewTitle.setPaintFlags(holder.textViewTitle.getPaintFlags() | Paint.STRIKE_THRU_TEXT_FLAG);
        } else {
            holder.textViewTitle.setPaintFlags(holder.textViewTitle.getPaintFlags() & (~Paint.STRIKE_THRU_TEXT_FLAG));
        }
    }

    /**
     * 获取格式化的时间描述
     * @param date 日期
     * @return 格式化的时间描述，例如 "今天 14:30" 或 "还有2天"
     */
    private String getFormattedTimeDescription(Date date) {
        if (date == null) return "";

        Calendar scheduleCalendar = Calendar.getInstance();
        scheduleCalendar.setTime(date);

        Calendar nowCalendar = Calendar.getInstance();

        // 计算日期差异
        long diffInMillis = scheduleCalendar.getTimeInMillis() - nowCalendar.getTimeInMillis();
        long diffInDays = TimeUnit.MILLISECONDS.toDays(diffInMillis);

        // 检查是否是同一天（今天）
        boolean isSameDay = scheduleCalendar.get(Calendar.YEAR) == nowCalendar.get(Calendar.YEAR) &&
                            scheduleCalendar.get(Calendar.DAY_OF_YEAR) == nowCalendar.get(Calendar.DAY_OF_YEAR);

        // 检查是否是明天
        Calendar tomorrowCalendar = Calendar.getInstance();
        tomorrowCalendar.add(Calendar.DAY_OF_YEAR, 1);
        boolean isTomorrow = scheduleCalendar.get(Calendar.YEAR) == tomorrowCalendar.get(Calendar.YEAR) &&
                             scheduleCalendar.get(Calendar.DAY_OF_YEAR) == tomorrowCalendar.get(Calendar.DAY_OF_YEAR);

        // 格式化时间
        String timeStr = timeFormat.format(date);

        if (isSameDay) {
            return "今天 " + timeStr;
        } else if (isTomorrow) {
            return "明天 " + timeStr;
        } else if (diffInDays > 0 && diffInDays < 7) {
            // 未来一周内的日期
            return "还有" + diffInDays + "天";
        } else if (diffInDays < 0) {
            // 过去的日期
            return Math.abs(diffInDays) + "天前";
        } else {
            // 更远的未来日期，使用完整日期格式
            SimpleDateFormat dateFormat = new SimpleDateFormat("MM-dd HH:mm", Locale.getDefault());
            return dateFormat.format(date);
        }
    }

    public Schedule getScheduleAt(int position) {
        return getItem(position);
    }

    class ScheduleViewHolder extends RecyclerView.ViewHolder {
        private TextView textViewTitle;
        private TextView textViewTime;
        private TextView textViewCategory;
        private CheckBox checkBoxCompleted;

        public ScheduleViewHolder(@NonNull View itemView) {
            super(itemView);
            textViewTitle = itemView.findViewById(R.id.text_view_title);
            textViewTime = itemView.findViewById(R.id.text_view_time);
            textViewCategory = itemView.findViewById(R.id.text_view_category);
            checkBoxCompleted = itemView.findViewById(R.id.checkbox_completed);

            itemView.setOnClickListener(v -> {
                int position = getAdapterPosition();
                if (listener != null && position != RecyclerView.NO_POSITION) {
                    listener.onScheduleClick(getItem(position));
                }
            });

            checkBoxCompleted.setOnClickListener(v -> {
                int position = getAdapterPosition();
                if (listener != null && position != RecyclerView.NO_POSITION) {
                    listener.onCompletedToggle(getItem(position));
                }
            });
        }
    }

    public interface OnScheduleListener {
        void onScheduleClick(Schedule schedule);
        void onCompletedToggle(Schedule schedule);
    }

    private static final DiffUtil.ItemCallback<Schedule> DIFF_CALLBACK = new DiffUtil.ItemCallback<Schedule>() {
        @Override
        public boolean areItemsTheSame(@NonNull Schedule oldItem, @NonNull Schedule newItem) {
            return oldItem.getId() == newItem.getId();
        }

        @Override
        public boolean areContentsTheSame(@NonNull Schedule oldItem, @NonNull Schedule newItem) {
            return oldItem.getTitle().equals(newItem.getTitle()) &&
                    oldItem.isCompleted() == newItem.isCompleted() &&
                    oldItem.getCategory().equals(newItem.getCategory());
        }
    };
}
```

#### ui/fragment/CalendarFragment

```java
package com.example.planwise.ui.fragment;


import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.CalendarView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.lifecycle.ViewModelProvider;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.example.planwise.R;
import com.example.planwise.data.model.Schedule;
import com.example.planwise.ui.activity.ScheduleDetailActivity;
import com.example.planwise.ui.adapter.ScheduleAdapter;
import com.example.planwise.ui.viewmodel.ScheduleViewModel;

import java.util.Calendar;
import java.util.Date;

public class CalendarFragment extends Fragment implements ScheduleAdapter.OnScheduleListener {

    private ScheduleViewModel viewModel;
    private CalendarView calendarView;
    private RecyclerView recyclerView;
    private TextView textViewNoSchedules;
    private ScheduleAdapter adapter;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        return inflater.inflate(R.layout.fragment_calendar, container, false);
    }

    @Override
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);

        // Setup ViewModel
        viewModel = new ViewModelProvider(requireActivity()).get(ScheduleViewModel.class);

        // Initialize views
        calendarView = view.findViewById(R.id.calendar_view);
        recyclerView = view.findViewById(R.id.recycler_view);
        textViewNoSchedules = view.findViewById(R.id.text_view_no_schedules);

        // Setup RecyclerView
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));
        adapter = new ScheduleAdapter(this);
        recyclerView.setAdapter(adapter);

        // Set initial date to today
        Date today = new Date();
        viewModel.setSelectedDate(today);

        // Setup CalendarView listener
        calendarView.setOnDateChangeListener((view1, year, month, dayOfMonth) -> {
            Calendar calendar = Calendar.getInstance();
            calendar.set(year, month, dayOfMonth);
            viewModel.setSelectedDate(calendar.getTime());
        });

        // Observe schedules for selected date
        viewModel.getSchedulesBySelectedDate().observe(getViewLifecycleOwner(), schedules -> {
            adapter.submitList(schedules);

            if (schedules == null || schedules.isEmpty()) {
                textViewNoSchedules.setVisibility(View.VISIBLE);
                recyclerView.setVisibility(View.GONE);
            } else {
                textViewNoSchedules.setVisibility(View.GONE);
                recyclerView.setVisibility(View.VISIBLE);
            }
        });
    }

    @Override
    public void onScheduleClick(Schedule schedule) {
        // Navigate to schedule detail
        Intent intent = new Intent(getActivity(), ScheduleDetailActivity.class);
        intent.putExtra("schedule_id", schedule.getId());
        startActivity(intent);
    }

    @Override
    public void onCompletedToggle(Schedule schedule) {
        viewModel.toggleScheduleCompleted(schedule);
    }
}
```

#### ui/fragment/ProfileFragment

```java
package com.example.planwise.ui.fragment;

import android.app.AlertDialog;
import android.content.DialogInterface;
import android.os.Bundle;
import android.text.InputType;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ProgressBar;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.lifecycle.ViewModelProvider;

import com.example.planwise.R;
import com.example.planwise.data.api.ApiClient;
import com.example.planwise.data.repository.ScheduleRepository;
import com.example.planwise.ui.viewmodel.ScheduleViewModel;

public class ProfileFragment extends Fragment {

    private ScheduleViewModel scheduleViewModel;
    private TextView textViewUsername;
    private TextView textViewEmail;
    private Button buttonLocalToCloud;
    private Button buttonCloudToLocal;
    private Button buttonSetServerIp;
    private ProgressBar progressBarSync;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        return inflater.inflate(R.layout.fragment_profile, container, false);
    }

    @Override
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);

        // Setup ViewModel
        scheduleViewModel = new ViewModelProvider(requireActivity()).get(ScheduleViewModel.class);

        // Initialize views
        textViewUsername = view.findViewById(R.id.text_view_username);
        textViewEmail = view.findViewById(R.id.text_view_email);
        buttonLocalToCloud = view.findViewById(R.id.button_local_to_cloud);
        buttonCloudToLocal = view.findViewById(R.id.button_cloud_to_local);
        buttonSetServerIp = view.findViewById(R.id.button_set_server_ip);
        progressBarSync = view.findViewById(R.id.progress_bar_sync);

        // Set default user
        textViewUsername.setText("Planwiser");
        textViewEmail.setText("用户默认");

        // Setup click listeners for sync buttons
        buttonLocalToCloud.setOnClickListener(v -> syncLocalToCloud());
        buttonCloudToLocal.setOnClickListener(v -> syncCloudToLocal());
        buttonSetServerIp.setOnClickListener(v -> showIpSettingDialog());

        // Observe syncing status
        scheduleViewModel.getIsSyncing().observe(getViewLifecycleOwner(), isSyncing -> {
            if (isSyncing) {
                progressBarSync.setVisibility(View.VISIBLE);
                buttonLocalToCloud.setEnabled(false);
                buttonCloudToLocal.setEnabled(false);
            } else {
                progressBarSync.setVisibility(View.GONE);
                buttonLocalToCloud.setEnabled(true);
                buttonCloudToLocal.setEnabled(true);
            }
        });
    }

    private void syncLocalToCloud() {
        scheduleViewModel.syncLocalToCloud(new ScheduleRepository.OnSyncCompleteListener() {
            @Override
            public void onSyncComplete(boolean success, String message) {
                requireActivity().runOnUiThread(() -> {
                    Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();
                });
            }
        });
    }

    private void syncCloudToLocal() {
        new AlertDialog.Builder(requireContext())
                .setTitle("确认同步")
                .setMessage("从云端同步将覆盖本地所有数据，确定要继续吗？")
                .setPositiveButton("确定", (dialog, which) -> {
                    scheduleViewModel.syncCloudToLocal(new ScheduleRepository.OnSyncCompleteListener() {
                        @Override
                        public void onSyncComplete(boolean success, String message) {
                            requireActivity().runOnUiThread(() -> {
                                Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show();
                            });
                        }
                    });
                })
                .setNegativeButton("取消", null)
                .show();
    }

    private void showIpSettingDialog() {
        EditText input = new EditText(getContext());
        input.setInputType(InputType.TYPE_CLASS_TEXT);
        input.setHint("例如: 192.168.1.100:8000");

        new AlertDialog.Builder(requireContext())
                .setTitle("设置服务器IP和端口")
                .setMessage("请输入Django服务器的IP地址和端口")
                .setView(input)
                .setPositiveButton("确定", (dialog, which) -> {
                    String ipAndPort = input.getText().toString().trim();
                    if (!ipAndPort.isEmpty()) {
                        // 设置服务器IP和端口
                        ApiClient.setBaseUrl("http://" + ipAndPort + "/");
                        Toast.makeText(getContext(), "服务器地址已设置为: " + ipAndPort, Toast.LENGTH_SHORT).show();
                    }
                })
                .setNegativeButton("取消", null)
                .show();
    }
}
```

#### ui/fragment/TodayTodoFragment

```java
package com.example.planwise.ui.fragment;
import android.app.AlertDialog;
import android.app.DatePickerDialog;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.Toast;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.HashSet;
import java.util.Locale;
import java.util.Set;
import android.app.TimePickerDialog;
import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MediatorLiveData;
import androidx.lifecycle.Observer;
import androidx.lifecycle.ViewModelProvider;
import androidx.recyclerview.widget.ItemTouchHelper;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.google.android.material.chip.Chip;
import com.google.android.material.chip.ChipGroup;
import com.google.android.material.floatingactionbutton.FloatingActionButton;
import com.example.planwise.R;
import com.example.planwise.data.model.Schedule;
import com.example.planwise.ui.activity.AddScheduleActivity;
import com.example.planwise.ui.activity.ScheduleDetailActivity;
import com.example.planwise.ui.adapter.ScheduleAdapter;
import com.example.planwise.ui.viewmodel.ScheduleViewModel;

import java.util.List;
import java.util.ArrayList;

public class TodayTodoFragment extends Fragment implements ScheduleAdapter.OnScheduleListener {

    private ScheduleViewModel viewModel;
    private ScheduleAdapter adapter;

    private List<Schedule> allSchedules = new ArrayList<>();
    private int currentFilter = FILTER_ALL;

    // Filter constants
    private static final int FILTER_ALL = 0;
    private static final int FILTER_INCOMPLETE = 1;
    private static final int FILTER_COMPLETED = 2;
    private static final int FILTER_TIME = 3;
    private static final int FILTER_TAG = 4;
    // 新增的快捷筛选类型
    private static final int FILTER_TODAY = 5;
    private static final int FILTER_THREE_DAYS = 6;
    private static final int FILTER_THIS_WEEK = 7;

    private Date filterStartDate = null;
    private Date filterEndDate = null;
    private String filterTag = null;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        return inflater.inflate(R.layout.fragment_today_todo, container, false);
    }

    @Override
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);

        // Setup ViewModel
        viewModel = new ViewModelProvider(requireActivity()).get(ScheduleViewModel.class);

        // Setup RecyclerView
        RecyclerView recyclerView = view.findViewById(R.id.recycler_view);
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));
        adapter = new ScheduleAdapter(this);
        recyclerView.setAdapter(adapter);

        // Setup filter chips
        ChipGroup chipGroupFilter = view.findViewById(R.id.chip_group_filter);
        Chip chipAll = view.findViewById(R.id.chip_filter_all);
        Chip chipIncomplete = view.findViewById(R.id.chip_filter_incomplete);
        Chip chipCompleted = view.findViewById(R.id.chip_filter_completed);

        chipGroupFilter.setOnCheckedChangeListener((group, checkedId) -> {
            if (checkedId == R.id.chip_filter_all) {
                currentFilter = FILTER_ALL;
            } else if (checkedId == R.id.chip_filter_incomplete) {
                currentFilter = FILTER_INCOMPLETE;
            } else if (checkedId == R.id.chip_filter_completed) {
                currentFilter = FILTER_COMPLETED;
            }

            // Apply the filter to current data
            applyFilter();
        });
        
        // Setup advanced filter button
        ImageButton btnAdvancedFilter = view.findViewById(R.id.btn_advanced_filter);
        btnAdvancedFilter.setOnClickListener(v -> {
            showAdvancedFilterDialog();
        });
        
        // Observe today's schedules
        viewModel.getAllSchedules().observe(getViewLifecycleOwner(), schedules -> {
            allSchedules = schedules != null ? schedules : new ArrayList<>();

            // Apply current filter to the new data
            applyFilter();

            // 只有当列表为空时才添加默认日程
            if (schedules == null || schedules.isEmpty()) {
                addDefaultSchedules();
            }
        });
        
        // Setup swipe delete functionality
        ItemTouchHelper.SimpleCallback simpleCallback = new ItemTouchHelper.SimpleCallback(0, ItemTouchHelper.LEFT | ItemTouchHelper.RIGHT) {
            @Override
            public boolean onMove(@NonNull RecyclerView recyclerView, @NonNull RecyclerView.ViewHolder viewHolder, @NonNull RecyclerView.ViewHolder target) {
                return false;
            }

            @Override
            public void onSwiped(@NonNull RecyclerView.ViewHolder viewHolder, int direction) {
                int position = viewHolder.getAdapterPosition();
                Schedule schedule = adapter.getScheduleAt(position);
                viewModel.deleteSchedule(schedule);
            }
        };

        new ItemTouchHelper(simpleCallback).attachToRecyclerView(recyclerView);

        // Setup FAB for adding new schedules
        FloatingActionButton add_todo_btn = view.findViewById(R.id.fab_add);
        add_todo_btn.setOnClickListener(v -> {
            Intent intent = new Intent(getActivity(), AddScheduleActivity.class);
            startActivity(intent);
        });
    }

    private void applyFilter() {
        List<Schedule> filteredList = new ArrayList<>();

        for (Schedule schedule : allSchedules) {
            boolean shouldInclude = false;

            switch (currentFilter) {
                case FILTER_ALL:
                    shouldInclude = true;
                    break;
                case FILTER_INCOMPLETE:
                    shouldInclude = !schedule.isCompleted();
                    break;
                case FILTER_COMPLETED:
                    shouldInclude = schedule.isCompleted();
                    break;
                case FILTER_TIME:
                    // Check if schedule is within time range
                    Date scheduleDate = schedule.getScheduledDate();

                    // If only start date is specified
                    if (filterStartDate != null && filterEndDate == null) {
                        shouldInclude = !scheduleDate.before(filterStartDate);
                    }
                    // If only end date is specified
                    else if (filterStartDate == null && filterEndDate != null) {
                        shouldInclude = !scheduleDate.after(filterEndDate);
                    }
                    // If both dates are specified
                    else if (filterStartDate != null && filterEndDate != null) {
                        shouldInclude = !scheduleDate.before(filterStartDate) && !scheduleDate.after(filterEndDate);
                    }
                    break;
                case FILTER_TAG:
                    // Check if schedule matches the tag
                    if (filterTag != null && schedule.getCategory() != null) {
                        shouldInclude = schedule.getCategory().equals(filterTag);
                    }
                    break;
                case FILTER_TODAY:
                    // 检查是否是今天的待办
                    shouldInclude = isScheduleToday(schedule);
                    break;
                case FILTER_THREE_DAYS:
                    // 检查是否是近三天的待办
                    shouldInclude = isScheduleWithinDays(schedule, 3);
                    break;
                case FILTER_THIS_WEEK:
                    // 检查是否是本周的待办
                    shouldInclude = isScheduleThisWeek(schedule);
                    break;
            }

            if (shouldInclude) {
                filteredList.add(schedule);
            }
        }

        adapter.submitList(filteredList);
    }

    // 检查日程是否是今天的
    private boolean isScheduleToday(Schedule schedule) {
        if (schedule.getScheduledDate() == null) return false;
        
        Calendar scheduleCalendar = Calendar.getInstance();
        scheduleCalendar.setTime(schedule.getScheduledDate());
        
        Calendar todayCalendar = Calendar.getInstance();
        
        return scheduleCalendar.get(Calendar.YEAR) == todayCalendar.get(Calendar.YEAR) &&
               scheduleCalendar.get(Calendar.DAY_OF_YEAR) == todayCalendar.get(Calendar.DAY_OF_YEAR);
    }
    
    // 检查日程是否在指定天数内
    private boolean isScheduleWithinDays(Schedule schedule, int days) {
        if (schedule.getScheduledDate() == null) return false;
        
        // 获取当前时间
        Calendar currentCalendar = Calendar.getInstance();
        // 设置为今天的开始时间
        currentCalendar.set(Calendar.HOUR_OF_DAY, 0);
        currentCalendar.set(Calendar.MINUTE, 0);
        currentCalendar.set(Calendar.SECOND, 0);
        currentCalendar.set(Calendar.MILLISECOND, 0);
        
        // 获取未来的截止时间
        Calendar futureCalendar = Calendar.getInstance();
        futureCalendar.add(Calendar.DAY_OF_YEAR, days);
        futureCalendar.set(Calendar.HOUR_OF_DAY, 23);
        futureCalendar.set(Calendar.MINUTE, 59);
        futureCalendar.set(Calendar.SECOND, 59);
        futureCalendar.set(Calendar.MILLISECOND, 999);
        
        return !schedule.getScheduledDate().before(currentCalendar.getTime()) && 
               !schedule.getScheduledDate().after(futureCalendar.getTime());
    }
    
    // 检查日程是否在本周内
    private boolean isScheduleThisWeek(Schedule schedule) {
        if (schedule.getScheduledDate() == null) return false;
        
        Calendar scheduleCalendar = Calendar.getInstance();
        scheduleCalendar.setTime(schedule.getScheduledDate());
        
        Calendar currentCalendar = Calendar.getInstance();
        
        // 检查是否是同一年的同一周
        return scheduleCalendar.get(Calendar.YEAR) == currentCalendar.get(Calendar.YEAR) &&
               scheduleCalendar.get(Calendar.WEEK_OF_YEAR) == currentCalendar.get(Calendar.WEEK_OF_YEAR);
    }

    @Override
    public void onScheduleClick(Schedule schedule) {
        // Navigate to schedule detail
        Intent intent = new Intent(getActivity(), ScheduleDetailActivity.class);
        intent.putExtra("schedule_id", schedule.getId());
        startActivity(intent);
    }

    @Override
    public void onCompletedToggle(Schedule schedule) {
        viewModel.toggleScheduleCompleted(schedule);
    }

    private void addDefaultSchedules() {
        // 获取当前日期
        java.util.Calendar calendar = java.util.Calendar.getInstance();
        java.util.Date today = calendar.getTime();

        // 创建3条默认日程，使用完整构造函数
        Schedule schedule1 = new Schedule(
                "完成Android作业",
                "完成PlanWise应用开发",
                today,
                "实验室", // 位置
                "学习", // 分类
                false // 完成状态
        );

        Schedule schedule2 = new Schedule(
                "阅读专业书籍",
                "阅读一小时专业相关书籍",
                today,
                "图书馆",
                "学习",
                false
        );

        Schedule schedule3 = new Schedule(
                "健身锻炼",
                "进行30分钟有氧运动",
                today,
                "健身房",
                "个人",
                false
        );

        // 将默认日程添加到数据库
        viewModel.insertSchedule(schedule1);
        viewModel.insertSchedule(schedule2);
        viewModel.insertSchedule(schedule3);
    }
    
    /**
     * Shows dialog for advanced filtering options
     */
    private void showAdvancedFilterDialog() {
        String[] options = {"今日待办", "近三天待办", "本周待办", "按时间筛选", "按标签筛选", "清除筛选"};

        new AlertDialog.Builder(requireContext())
                .setTitle("选择筛选方式")
                .setItems(options, (dialog, which) -> {
                    switch (which) {
                        case 0: // 今日待办
                            applyTodayFilter();
                            break;
                        case 1: // 近三天待办
                            applyThreeDaysFilter();
                            break;
                        case 2: // 本周待办
                            applyThisWeekFilter();
                            break;
                        case 3: // 按时间筛选
                            showTimeFilterDialog();
                            break;
                        case 4: // 按标签筛选
                            showTagFilterDialog();
                            break;
                        case 5: // 清除筛选
                            clearAdvancedFilters();
                            break;
                    }
                })
                .show();
    }
    
    // 应用今日待办筛选
    private void applyTodayFilter() {
        currentFilter = FILTER_TODAY;
        // 重置筛选芯片选择
        ChipGroup chipGroup = requireView().findViewById(R.id.chip_group_filter);
        chipGroup.clearCheck();
        applyFilter();
        Toast.makeText(requireContext(), "已筛选今日待办", Toast.LENGTH_SHORT).show();
    }
    
    // 应用近三天待办筛选
    private void applyThreeDaysFilter() {
        currentFilter = FILTER_THREE_DAYS;
        // 重置筛选芯片选择
        ChipGroup chipGroup = requireView().findViewById(R.id.chip_group_filter);
        chipGroup.clearCheck();
        applyFilter();
        Toast.makeText(requireContext(), "已筛选近三天待办", Toast.LENGTH_SHORT).show();
    }
    
    // 应用本周待办筛选
    private void applyThisWeekFilter() {
        currentFilter = FILTER_THIS_WEEK;
        // 重置筛选芯片选择
        ChipGroup chipGroup = requireView().findViewById(R.id.chip_group_filter);
        chipGroup.clearCheck();
        applyFilter();
        Toast.makeText(requireContext(), "已筛选本周待办", Toast.LENGTH_SHORT).show();
    }

    /**
     * Shows dialog for time-based filtering
     */
    private void showTimeFilterDialog() {
        View dialogView = LayoutInflater.from(requireContext())
                .inflate(R.layout.dialog_time_filter, null);

        EditText etStartDate = dialogView.findViewById(R.id.et_start_date);
        EditText etStartTime = dialogView.findViewById(R.id.et_start_time);
        EditText etEndDate = dialogView.findViewById(R.id.et_end_date);
        EditText etEndTime = dialogView.findViewById(R.id.et_end_time);

        // 初始化日历对象用于保存选择的时间
        Calendar startCalendar = Calendar.getInstance();
        Calendar endCalendar = Calendar.getInstance();

        // 默认时间格式化器
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd", Locale.getDefault());
        SimpleDateFormat timeFormat = new SimpleDateFormat("HH:mm", Locale.getDefault());

        // 设置日期选择器 - 开始日期
        etStartDate.setOnClickListener(v -> {
            showDatePicker((view, year, month, dayOfMonth) -> {
                startCalendar.set(Calendar.YEAR, year);
                startCalendar.set(Calendar.MONTH, month);
                startCalendar.set(Calendar.DAY_OF_MONTH, dayOfMonth);
                etStartDate.setText(dateFormat.format(startCalendar.getTime()));
            });
        });

        // 设置日期选择器 - 结束日期
        etEndDate.setOnClickListener(v -> {
            showDatePicker((view, year, month, dayOfMonth) -> {
                endCalendar.set(Calendar.YEAR, year);
                endCalendar.set(Calendar.MONTH, month);
                endCalendar.set(Calendar.DAY_OF_MONTH, dayOfMonth);
                etEndDate.setText(dateFormat.format(endCalendar.getTime()));
            });
        });

        // 设置时间选择器 - 开始时间
        etStartTime.setOnClickListener(v -> {
            Calendar calendar = Calendar.getInstance();
            int hour = calendar.get(Calendar.HOUR_OF_DAY);
            int minute = calendar.get(Calendar.MINUTE);

            new TimePickerDialog(
                    requireContext(),
                    (view, hourOfDay, minute1) -> {
                        startCalendar.set(Calendar.HOUR_OF_DAY, hourOfDay);
                        startCalendar.set(Calendar.MINUTE, minute1);
                        startCalendar.set(Calendar.SECOND, 0);
                        startCalendar.set(Calendar.MILLISECOND, 0);
                        etStartTime.setText(timeFormat.format(startCalendar.getTime()));
                    },
                    hour,
                    minute,
                    true // 24小时制
            ).show();
        });

        // 设置时间选择器 - 结束时间
        etEndTime.setOnClickListener(v -> {
            Calendar calendar = Calendar.getInstance();
            int hour = calendar.get(Calendar.HOUR_OF_DAY);
            int minute = calendar.get(Calendar.MINUTE);

            new TimePickerDialog(
                    requireContext(),
                    (view, hourOfDay, minute1) -> {
                        endCalendar.set(Calendar.HOUR_OF_DAY, hourOfDay);
                        endCalendar.set(Calendar.MINUTE, minute1);
                        endCalendar.set(Calendar.SECOND, 59);
                        endCalendar.set(Calendar.MILLISECOND, 999);
                        etEndTime.setText(timeFormat.format(endCalendar.getTime()));
                    },
                    hour,
                    minute,
                    true // 24小时制
            ).show();
        });

        new AlertDialog.Builder(requireContext())
                .setTitle("按时间筛选")
                .setView(dialogView)
                .setPositiveButton("确定", (dialog, which) -> {
                    // 获取开始和结束日期时间
                    Date startDate = null;
                    Date endDate = null;

                    // 如果开始日期已设置
                    if (!etStartDate.getText().toString().isEmpty()) {
                        startDate = startCalendar.getTime();
                    }

                    // 如果结束日期已设置
                    if (!etEndDate.getText().toString().isEmpty()) {
                        endDate = endCalendar.getTime();
                    }

                    // 应用时间筛选
                    filterStartDate = startDate;
                    filterEndDate = endDate;
                    currentFilter = FILTER_TIME;

                    // 重置筛选芯片选择
                    ChipGroup chipGroup = requireView().findViewById(R.id.chip_group_filter);
                    chipGroup.clearCheck();

                    applyFilter();
                })
                .setNegativeButton("取消", null)
                .show();
    }

    /**
     * 显示时间选择器
     */
    private void showTimePicker(TimePickerDialog.OnTimeSetListener listener) {
        Calendar calendar = Calendar.getInstance();
        int hour = calendar.get(Calendar.HOUR_OF_DAY);
        int minute = calendar.get(Calendar.MINUTE);

        // 创建24小时制的时间选择器
        TimePickerDialog timePickerDialog = new TimePickerDialog(
                requireContext(),
                listener,
                hour,
                minute,
                true // 24小时制
        );

        timePickerDialog.show();
    }
    
    /**
     * Shows DatePickerDialog with the given listener
     */
    private void showDatePicker(DatePickerDialog.OnDateSetListener listener) {
        Calendar calendar = Calendar.getInstance();
        int year = calendar.get(Calendar.YEAR);
        int month = calendar.get(Calendar.MONTH);
        int day = calendar.get(Calendar.DAY_OF_MONTH);

        DatePickerDialog datePickerDialog = new DatePickerDialog(
                requireContext(),
                listener,
                year,
                month,
                day
        );

        datePickerDialog.show();
    }

    /**
     * Shows dialog for tag-based filtering
     */
    private void showTagFilterDialog() {
        // Get all unique tags from schedules
        Set<String> tags = new HashSet<>();
        for (Schedule schedule : allSchedules) {
            if (schedule.getCategory() != null && !schedule.getCategory().isEmpty()) {
                tags.add(schedule.getCategory());
            }
        }

        if (tags.isEmpty()) {
            Toast.makeText(requireContext(), "没有可用的标签", Toast.LENGTH_SHORT).show();
            return;
        }

        String[] tagArray = tags.toArray(new String[0]);

        new AlertDialog.Builder(requireContext())
                .setTitle("选择标签")
                .setItems(tagArray, (dialog, which) -> {
                    filterTag = tagArray[which];
                    currentFilter = FILTER_TAG;

                    // Reset chips selection
                    ChipGroup chipGroup = requireView().findViewById(R.id.chip_group_filter);
                    chipGroup.clearCheck();

                    applyFilter();
                })
                .setNegativeButton("取消", null)
                .show();
    }

    /**
     * Clear all advanced filters
     */
    private void clearAdvancedFilters() {
        filterStartDate = null;
        filterEndDate = null;
        filterTag = null;

        // Reset to show all tasks
        currentFilter = FILTER_ALL;

        // Select the "All" chip
        ChipGroup chipGroup = requireView().findViewById(R.id.chip_group_filter);
        Chip chipAll = requireView().findViewById(R.id.chip_filter_all);
        chipAll.setChecked(true);

        applyFilter();

        Toast.makeText(requireContext(), "已清除筛选", Toast.LENGTH_SHORT).show();
    }
}
```

#### ui/viewmodel/ScheduleViewModel

```java
package com.example.planwise.ui.viewmodel;

import android.app.Application;

import androidx.lifecycle.AndroidViewModel;
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.Transformations;

import com.example.planwise.data.model.Schedule;
import com.example.planwise.data.repository.ScheduleRepository;

import java.util.Calendar;
import java.util.Date;
import java.util.List;

public class ScheduleViewModel extends AndroidViewModel {
    private ScheduleRepository repository;
    private LiveData<List<Schedule>> allSchedules;
    private LiveData<List<Schedule>> incompleteSchedules;
    private LiveData<List<Schedule>> completedSchedules;
    private LiveData<List<String>> allCategories;

    // For calendar view
    private MutableLiveData<Date> selectedDate = new MutableLiveData<>();
    private LiveData<List<Schedule>> schedulesBySelectedDate;

    // For category filtering
    private MutableLiveData<String> selectedCategory = new MutableLiveData<>();
    private LiveData<List<Schedule>> schedulesBySelectedCategory;

    // For date range filtering
    private MutableLiveData<Date> startDate = new MutableLiveData<>();
    private MutableLiveData<Date> endDate = new MutableLiveData<>();
    private LiveData<List<Schedule>> schedulesByDateRange;

    // 同步状态
    private LiveData<Boolean> isSyncing;
    
    // AI建议状态
    private MutableLiveData<Boolean> isLoadingAiSuggestion = new MutableLiveData<>(false);
    private MutableLiveData<String> aiSuggestion = new MutableLiveData<>();

    public ScheduleViewModel(Application application) {
        super(application);
        repository = new ScheduleRepository(application);
        allSchedules = repository.getAllSchedules();
        incompleteSchedules = repository.getIncompleteSchedules();
        completedSchedules = repository.getCompletedSchedules();
        allCategories = repository.getAllCategories();
        isSyncing = repository.getIsSyncing();

        // Initialize with today's date
        selectedDate.setValue(new Date());

        // Setup transformations for filtered data
        schedulesBySelectedDate = Transformations.switchMap(selectedDate,
                date -> repository.getSchedulesByDate(date));

        schedulesBySelectedCategory = Transformations.switchMap(selectedCategory,
                category -> repository.getIncompleteSchedulesByCategory(category));

        schedulesByDateRange = Transformations.switchMap(startDate, start ->
                Transformations.switchMap(endDate, end -> {
                    if (start != null && end != null) {
                        return repository.getSchedulesBetweenDates(start, end);
                    }
                    return repository.getAllSchedules();
                }));
    }

    // Schedule operations
    public void insertSchedule(Schedule schedule) {
        repository.insert(schedule);
    }

    public void updateSchedule(Schedule schedule) {
        repository.update(schedule);
    }

    public void deleteSchedule(Schedule schedule) {
        repository.delete(schedule);
    }

    public void toggleScheduleCompleted(Schedule schedule) {
        repository.toggleCompleted(schedule);
    }

    // LiveData getters
    public LiveData<List<Schedule>> getAllSchedules() {
        return allSchedules;
    }

    public LiveData<List<Schedule>> getIncompleteSchedules() {
        return incompleteSchedules;
    }

    public LiveData<List<Schedule>> getCompletedSchedules() {
        return completedSchedules;
    }

    public LiveData<Schedule> getScheduleById(long id) {
        return repository.getScheduleById(id);
    }

    public LiveData<List<String>> getAllCategories() {
        return allCategories;
    }

    // Date selection
    public void setSelectedDate(Date date) {
        selectedDate.setValue(date);
    }

    public LiveData<Date> getSelectedDate() {
        return selectedDate;
    }

    public LiveData<List<Schedule>> getSchedulesBySelectedDate() {
        return schedulesBySelectedDate;
    }

    // Category selection
    public void setSelectedCategory(String category) {
        selectedCategory.setValue(category);
    }

    public LiveData<String> getSelectedCategory() {
        return selectedCategory;
    }

    public LiveData<List<Schedule>> getSchedulesBySelectedCategory() {
        return schedulesBySelectedCategory;
    }

    // Date range selection
    public void setDateRange(Date start, Date end) {
        startDate.setValue(start);
        endDate.setValue(end);
    }

    public LiveData<List<Schedule>> getSchedulesByDateRange() {
        return schedulesByDateRange;
    }

    // Today's schedules
    public LiveData<List<Schedule>> getTodaySchedules() {
        Calendar calendar = Calendar.getInstance();
        calendar.set(Calendar.HOUR_OF_DAY, 0);
        calendar.set(Calendar.MINUTE, 0);
        calendar.set(Calendar.SECOND, 0);
        Date startOfDay = calendar.getTime();

        calendar.set(Calendar.HOUR_OF_DAY, 23);
        calendar.set(Calendar.MINUTE, 59);
        calendar.set(Calendar.SECOND, 59);
        Date endOfDay = calendar.getTime();

        return repository.getSchedulesBetweenDates(startOfDay, endOfDay);
    }


    // 同步本地数据到云端
    public void syncLocalToCloud(ScheduleRepository.OnSyncCompleteListener listener) {
        repository.syncLocalToCloud(listener);
    }

    // 同步云端数据到本地
    public void syncCloudToLocal(ScheduleRepository.OnSyncCompleteListener listener) {
        repository.syncCloudToLocal(listener);
    }

    // 获取同步状态
    public LiveData<Boolean> getIsSyncing() {
        return isSyncing;
    }
    
    // 获取AI建议
    public void getAiSuggestion(Schedule schedule) {
        isLoadingAiSuggestion.setValue(true);
        
        repository.getAiSuggestion(schedule, new ScheduleRepository.OnAiSuggestionListener() {
            @Override
            public void onAiSuggestionReceived(boolean success, String suggestion) {
                isLoadingAiSuggestion.postValue(false);
                if (success) {
                    aiSuggestion.postValue(suggestion);
                } else {
                    aiSuggestion.postValue("获取建议失败，请稍后再试。");
                }
            }
        });
    }
    
    // 获取AI建议加载状态
    public LiveData<Boolean> getIsLoadingAiSuggestion() {
        return isLoadingAiSuggestion;
    }
    
    // 获取AI建议内容
    public LiveData<String> getAiSuggestion() {
        return aiSuggestion;
    }
}
```

#### ui/viewmodel/UserViewModel

```java
package com.example.planwise.ui.viewmodel;


import android.app.Application;

import androidx.lifecycle.AndroidViewModel;
import androidx.lifecycle.LiveData;

import com.example.planwise.data.model.User;
import com.example.planwise.data.repository.UserRepository;

public class UserViewModel extends AndroidViewModel {
    private UserRepository repository;
    private LiveData<User> currentUser;
    private LiveData<Boolean> isLoggedIn;

    public UserViewModel(Application application) {
        super(application);
        repository = new UserRepository(application);
        currentUser = repository.getCurrentUser();
        isLoggedIn = repository.getIsLoggedIn();
    }

    public void login(String userId, String username, String email) {
        repository.login(userId, username, email);
    }

    public void logout() {
        repository.logout();
    }

    public void updateSyncPreference(boolean enabled) {
        repository.updateSyncPreference(enabled);
    }

    public LiveData<User> getCurrentUser() {
        return currentUser;
    }

    public LiveData<Boolean> getIsLoggedIn() {
        return isLoggedIn;
    }
}
```

### res（依照框架内容进行排序）

#### activity_add_schedule.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:fitsSystemWindows="true"
    tools:context=".ui.activity.AddScheduleActivity">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="16dp">

        <com.google.android.material.textfield.TextInputLayout
            style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            android:hint="标题">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/edit_text_title"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text" />
        </com.google.android.material.textfield.TextInputLayout>

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="16dp"
            android:orientation="horizontal">

            <com.google.android.material.textfield.TextInputLayout
                style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_marginEnd="8dp"
                android:layout_weight="1"
                android:hint="日期">

                <com.google.android.material.textfield.TextInputEditText
                    android:id="@+id/edit_text_date"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:focusable="false"
                    android:inputType="none" />
            </com.google.android.material.textfield.TextInputLayout>

            <com.google.android.material.textfield.TextInputLayout
                style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:hint="时间">

                <com.google.android.material.textfield.TextInputEditText
                    android:id="@+id/edit_text_time"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:focusable="false"
                    android:inputType="none" />
            </com.google.android.material.textfield.TextInputLayout>
        </LinearLayout>

        <com.google.android.material.textfield.TextInputLayout
            style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="16dp"
            android:hint="地点">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/edit_text_location"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text" />
        </com.google.android.material.textfield.TextInputLayout>

        <com.google.android.material.textfield.TextInputLayout
            style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="16dp"
            android:hint="备注">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/edit_text_description"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:gravity="top"
                android:inputType="textMultiLine"
                android:lines="3" />
        </com.google.android.material.textfield.TextInputLayout>
        
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="16dp"
            android:orientation="horizontal"
            android:gravity="center_vertical">
            
            <TextView
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="待办标签"
                android:textAppearance="@style/TextAppearance.MaterialComponents.Subtitle1" />
                
            <Button
                android:id="@+id/button_add_tag"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="新增标签"
                style="@style/Widget.MaterialComponents.Button.TextButton" />
        </LinearLayout>

        <com.google.android.material.chip.ChipGroup
            android:id="@+id/chip_group_category"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            app:singleSelection="true" />

        <Button
            android:id="@+id/button_save"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="24dp"
            android:text="保存" />

    </LinearLayout>
</ScrollView>
```

#### activity_main.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:fitsSystemWindows="true"
    tools:context=".ui.activity.MainActivity">

    <androidx.fragment.app.FragmentContainerView
        android:id="@+id/nav_host_fragment"
        android:name="androidx.navigation.fragment.NavHostFragment"
        android:layout_width="0dp"
        android:layout_height="0dp"
        app:defaultNavHost="true"
        app:layout_constraintBottom_toTopOf="@+id/bottom_navigation"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"
        app:layout_constraintTop_toTopOf="parent"
        app:navGraph="@navigation/nav_graph" />

    <com.google.android.material.bottomnavigation.BottomNavigationView
        android:id="@+id/bottom_navigation"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_gravity="bottom"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"
        app:menu="@menu/bottom_nav_menu"
        app:itemRippleColor="@null"
        app:itemActiveIndicatorStyle="@null"
        app:itemTextColor="@color/bottom_nav_color"
        app:itemIconTint="@color/bottom_nav_color"/>

</androidx.constraintlayout.widget.ConstraintLayout>
```

#### activity_schedule_detail.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:fitsSystemWindows="true"
    tools:context=".ui.activity.ScheduleDetailActivity">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:padding="16dp">

        <TextView
            android:id="@+id/text_view_title"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:textAppearance="@style/TextAppearance.MaterialComponents.Headline5"
            app:layout_constraintEnd_toStartOf="@+id/checkbox_completed"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            tools:text="完成Android作业" />

        <CheckBox
            android:id="@+id/checkbox_completed"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintTop_toTopOf="parent" />

        <TextView
            android:id="@+id/text_view_category_label"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="16dp"
            android:text="分类:"
            android:textStyle="bold"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/text_view_title" />

        <TextView
            android:id="@+id/text_view_category"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginStart="8dp"
            android:background="@drawable/bg_category"
            android:paddingHorizontal="8dp"
            android:paddingVertical="2dp"
            android:textColor="@color/white"
            app:layout_constraintBottom_toBottomOf="@+id/text_view_category_label"
            app:layout_constraintStart_toEndOf="@+id/text_view_category_label"
            app:layout_constraintTop_toTopOf="@+id/text_view_category_label"
            tools:text="学习" />

        <TextView
            android:id="@+id/text_view_date_time_label"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="16dp"
            android:text="时间:"
            android:textStyle="bold"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/text_view_category_label" />

        <TextView
            android:id="@+id/text_view_date_time"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginStart="8dp"
            app:layout_constraintBottom_toBottomOf="@+id/text_view_date_time_label"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toEndOf="@+id/text_view_date_time_label"
            app:layout_constraintTop_toTopOf="@+id/text_view_date_time_label"
            tools:text="2025年4月15日 14:30" />

        <TextView
            android:id="@+id/text_view_location_label"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="16dp"
            android:text="地点:"
            android:textStyle="bold"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/text_view_date_time_label" />

        <TextView
            android:id="@+id/text_view_location"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginStart="8dp"
            app:layout_constraintBottom_toBottomOf="@+id/text_view_location_label"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toEndOf="@+id/text_view_location_label"
            app:layout_constraintTop_toTopOf="@+id/text_view_location_label"
            tools:text="图书馆" />

        <TextView
            android:id="@+id/text_view_description_label"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="16dp"
            android:text="描述:"
            android:textStyle="bold"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/text_view_location_label" />

        <TextView
            android:id="@+id/text_view_description"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/text_view_description_label"
            tools:text="需要完成Android大作业的初步设计，包括UI设计和数据结构设计" />

        <com.google.android.material.card.MaterialCardView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="24dp"
            app:cardCornerRadius="8dp"
            app:cardElevation="2dp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/text_view_description">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp">

                <TextView
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="AI小助手建议"
                    android:textAppearance="@style/TextAppearance.MaterialComponents.Subtitle1"
                    android:textStyle="bold" />

                <TextView
                    android:id="@+id/text_view_ai_suggestion"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="8dp"
                    tools:text="建议提前准备相关资料，并分配足够的时间完成这项任务。可以将任务分解为UI设计、数据结构设计和文档编写三个部分，逐步完成。" />
            </LinearLayout>
        </com.google.android.material.card.MaterialCardView>

    </androidx.constraintlayout.widget.ConstraintLayout>
</ScrollView>
```

#### dialog_time_filter.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:padding="16dp">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="开始日期"
        android:textSize="16sp"
        android:textColor="@android:color/black" />

    <EditText
        android:id="@+id/et_start_date"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:focusable="false"
        android:hint="点击选择起始日期"
        android:inputType="none" />

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="12dp"
        android:text="开始时间"
        android:textSize="16sp"
        android:textColor="@android:color/black" />

    <EditText
        android:id="@+id/et_start_time"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:focusable="false"
        android:hint="点击选择起始时间"
        android:inputType="none" />

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:text="结束日期"
        android:textSize="16sp"
        android:textColor="@android:color/black" />

    <EditText
        android:id="@+id/et_end_date"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:focusable="false"
        android:hint="点击选择结束日期"
        android:inputType="none" />

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="12dp"
        android:text="结束时间"
        android:textSize="16sp"
        android:textColor="@android:color/black" />

    <EditText
        android:id="@+id/et_end_time"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:focusable="false"
        android:hint="点击选择结束时间"
        android:inputType="none" />

</LinearLayout>
```

#### fragment_calendar.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    tools:context=".ui.fragment.CalendarFragment">
    <TextView
        android:id="@+id/text_view_title"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="日程"
        style="@style/PageTitle"/>

    <CalendarView
        android:id="@+id/calendar_view"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginHorizontal="16dp"
        android:layout_marginTop="8dp" />

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginHorizontal="16dp"
        android:layout_marginTop="8dp"
        android:text="日程列表"
        android:textAppearance="@style/TextAppearance.MaterialComponents.Subtitle1" />

    <FrameLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent">

        <androidx.recyclerview.widget.RecyclerView
            android:id="@+id/recycler_view"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:clipToPadding="false"
            android:padding="8dp" />

        <TextView
            android:id="@+id/text_view_no_schedules"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_gravity="center"
            android:text="当天没有日程安排"
            android:textAlignment="center"
            android:visibility="gone" />
    </FrameLayout>
</LinearLayout>
```

#### fragment_profile.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="16dp"
    tools:context=".ui.fragment.ProfileFragment">

    <TextView
        android:id="@+id/text_view_title"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="我的"
        style="@style/PageTitle"/>

    <com.google.android.material.card.MaterialCardView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginBottom="16dp"
        app:cardCornerRadius="8dp"
        app:cardElevation="2dp">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="16dp">

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="个人信息"
                android:textAppearance="@style/TextAppearance.MaterialComponents.Headline6" />

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="16dp"
                android:text="用户名"
                android:textStyle="bold" />

            <TextView
                android:id="@+id/text_view_username"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="4dp"
                tools:text="Planwiser" />

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="16dp"
                android:text="状态"
                android:textStyle="bold" />

            <TextView
                android:id="@+id/text_view_email"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="4dp"
                tools:text="用户默认" />
        </LinearLayout>
    </com.google.android.material.card.MaterialCardView>

    <com.google.android.material.card.MaterialCardView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginBottom="16dp"
        app:cardCornerRadius="8dp"
        app:cardElevation="2dp">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="16dp">

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="云同步设置"
                android:textAppearance="@style/TextAppearance.MaterialComponents.Headline6" />

            <Button
                android:id="@+id/button_set_server_ip"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="16dp"
                android:text="设置服务器地址" />

            <ProgressBar
                android:id="@+id/progress_bar_sync"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center"
                android:layout_marginTop="8dp"
                android:visibility="gone" />

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                android:layout_marginTop="8dp">

                <Button
                    android:id="@+id/button_local_to_cloud"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:layout_marginEnd="4dp"
                    android:text="将本地数据同步到云" />

                <Button
                    android:id="@+id/button_cloud_to_local"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:layout_marginStart="4dp"
                    android:text="将云数据同步到本地" />
            </LinearLayout>
        </LinearLayout>
    </com.google.android.material.card.MaterialCardView>
</LinearLayout>
```

#### fragment_today_todo.xml

```xml
<?xml version="1.0" encoding="utf-8"?>

<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".ui.fragment.TodayTodoFragment"
    xmlns:app="http://schemas.android.com/apk/res-auto">
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical">
    <TextView
        android:id="@+id/text_view_title"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="待办列表"
        style="@style/PageTitle"/>
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="center_vertical"
            android:layout_marginTop="8dp"
            android:layout_marginStart="16dp"
            android:layout_marginEnd="16dp">

            <!-- Existing ChipGroup -->
            <com.google.android.material.chip.ChipGroup
                android:id="@+id/chip_group_filter"
                android:layout_width="0dp"
                android:layout_weight="1"
                android:layout_height="wrap_content"
                app:singleSelection="true">

                <com.google.android.material.chip.Chip
                    android:id="@+id/chip_filter_all"
                    style="@style/Widget.MaterialComponents.Chip.Choice"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:checked="true"
                    android:text="全部" />

                <com.google.android.material.chip.Chip
                    android:id="@+id/chip_filter_incomplete"
                    style="@style/Widget.MaterialComponents.Chip.Choice"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="未完成" />

                <com.google.android.material.chip.Chip
                    android:id="@+id/chip_filter_completed"
                    style="@style/Widget.MaterialComponents.Chip.Choice"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="已完成" />
            </com.google.android.material.chip.ChipGroup>

            <!-- Add separate filter button -->
            <ImageButton
                android:id="@+id/btn_advanced_filter"
                android:layout_width="18dp"
                android:layout_height="18dp"
                android:background="?attr/selectableItemBackgroundBorderless"
                android:contentDescription="高级筛选"
                android:scaleType="centerInside"
                android:src="@drawable/ic_filter"
                app:tint="?attr/colorPrimary" />
        </LinearLayout>
    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/recycler_view"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:clipToPadding="false"
        android:padding="8dp" />

    <TextView
        android:id="@+id/text_view_empty"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_gravity="center"
        android:text="暂无待办事项"
        android:textAlignment="center"
        android:visibility="gone" />
    </LinearLayout>
    <com.google.android.material.floatingactionbutton.FloatingActionButton
        android:id="@+id/fab_add"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="bottom|end"
        android:layout_margin="16dp"
        android:contentDescription="添加新任务"
        android:src="@android:drawable/ic_input_add" />
</FrameLayout>
```

#### item_schedule.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<com.google.android.material.card.MaterialCardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_marginHorizontal="8dp"
    android:layout_marginVertical="4dp"
    app:cardCornerRadius="8dp"
    app:cardElevation="2dp">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:padding="16dp">

        <CheckBox
            android:id="@+id/checkbox_completed"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent" />

        <TextView
            android:id="@+id/text_view_title"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginStart="8dp"
            android:layout_marginEnd="8dp"
            android:textSize="16sp"
            android:textStyle="bold"
            app:layout_constraintEnd_toStartOf="@+id/text_view_time"
            app:layout_constraintStart_toEndOf="@+id/checkbox_completed"
            app:layout_constraintTop_toTopOf="parent"
            tools:text="完成Android作业" />

        <TextView
            android:id="@+id/text_view_category"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginStart="8dp"
            android:layout_marginTop="4dp"
            android:background="@drawable/bg_category"
            android:paddingHorizontal="8dp"
            android:paddingVertical="2dp"
            android:textColor="@color/white"
            android:textSize="12sp"
            app:layout_constraintStart_toEndOf="@+id/checkbox_completed"
            app:layout_constraintTop_toBottomOf="@+id/text_view_title"
            tools:text="学习" />

        <TextView
            android:id="@+id/text_view_time"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:textSize="14sp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            tools:text="14:30" />

    </androidx.constraintlayout.widget.ConstraintLayout>
</com.google.android.material.card.MaterialCardView>
```

#### bottom_nav_menu.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<menu xmlns:android="http://schemas.android.com/apk/res/android">
    <item
        android:id="@+id/navigation_today"
        android:icon="@drawable/ic_bottom_nav_today"
        android:title="待办列表" />
    <item
        android:id="@+id/navigation_calendar"
        android:icon="@drawable/ic_bottom_nav_calendar"
        android:title="日程" />
    <item
        android:id="@+id/navigation_profile"
        android:icon="@drawable/ic_bottom_nav_profile"
        android:title="我的" />
</menu>
```

#### menu_schedule_detail.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<menu xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto">
    <item
        android:id="@+id/action_edit"
        android:icon="@android:drawable/ic_menu_edit"
        android:title="编辑"
        app:showAsAction="ifRoom" />
    <item
        android:id="@+id/action_delete"
        android:icon="@android:drawable/ic_menu_delete"
        android:title="删除"
        app:showAsAction="ifRoom" />
</menu>
```

